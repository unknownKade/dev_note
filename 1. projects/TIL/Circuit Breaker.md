# Circuit Breaker
- checks and stops/restarts calls between services to maintain stability of the overall system
- when calls fail repeatedly the circuit breaker detects this as a system failure and isolates it to not affect other parts of the system
- circuit breaker routing prevents cascading failures where a failure from one api continues to trigger failures
- different from [Retry Pattern]
- managed through three states
	- Close : circuit breaker is closed and all calls are passed. when a call fails the fail counter goes up
	- Open : when the fail count exceeds the limit, all calls attempts are stopped and returns an error. will be half-closed after alloted wait time passes
	- Half-Closed : sends out a few calls to check if it continues to return failure. If even one of them fails the circuit breaker is opened again
	- Fallback : fallback logic for when calls fail
	- Monitoring : monitoring tool for the circuit breaker

# Resilence4j
- Hystrix like library made for functional programming
- flexibible 

``` yaml
implementation 'io.github.resilience4j:resilience4j-spring-boot3:2.2.0' implementation 'org.springframework.boot:spring-boot-starter-aop'


server:  
  port: 19090  
  
resilience4j:  
  circuitbreaker:  
    configs:  
      default:
        registerHealthIndicator: true
		# sliding window
		#COUNT_BASED:states is based on the last N calls
		#slidingWindowType: COUNT_BASED  # ???? ???? ??? ?? ? ??(COUNT_BASED)?? ??  
        # ???? ???? ??? ??        # COUNT_BASED? ??: ?? N?? ??? ??        # TIME_BASED? ??: ?? N? ??? ??? ??        slidingWindowSize: 5  # ???? ???? ??? 5?? ??? ??  
        minimumNumberOfCalls: 5  # ?? ????? ???? ?? ??? ???? ?? ?? 5? ??  
        slowCallRateThreshold: 100  # ?? ??? ??? ? ???(100%)? ???? ?? ????? ??  
        slowCallDurationThreshold: 60000  # ?? ??? ?? ??(???)??, 60? ?? ??? ?? ??? ??  
        failureRateThreshold: 50  # ???? ? ???(50%)? ???? ?? ????? ??  
        permittedNumberOfCallsInHalfOpenState: 3  # ?? ????? Half-open ???? ???? ?? ?? ?? 3?? ??  
        # ?? ????? Open ???? Half-open ??? ???? ?? ???? ??        waitDurationInOpenState: 20s  # Open ???? Half-open ??? ???? ?? ???? ??? 20?? ??  
  
management:  
  endpoints:  
    web:  
      exposure:  
        include: prometheus  
  prometheus:  
    metrics:  
      export:  
        enabled: true
```